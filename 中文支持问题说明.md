# 中文支持问题及解决方案

## 🐛 遇到的问题

### 1. jsPDF 中文乱码

**问题描述：** jsPDF生成的PDF中，中文字符显示为乱码或方块
**错误信息：** 中文字符无法正确渲染

**原因分析：**

- jsPDF默认只支持标准西文字体（Helvetica, Times, Courier等）
- 这些字体不包含中文字符集
- 需要手动嵌入中文字体文件

### 2. PDF-LIB 中文编码错误

**问题描述：** PDF-LIB生成PDF时报错
**错误信息：** `WinAnsi cannot encode "这" (0x8fd9)`

**原因分析：**

- PDF-LIB默认使用WinAnsi编码（仅支持西欧语言）
- 中文字符不在WinAnsi字符集中
- 需要嵌入支持中文的字体

### 3. print-html-element 导入错误

**问题描述：** 调用时提示不是函数
**错误信息：** `printElement is not a function`

**原因分析：**

- 该库使用CommonJS模块导出
- ES6 `import` 语法导入可能不兼容
- 需要使用`require()`方式导入

## ✅ 解决方案

### 方案 1️⃣：使用英文内容（当前采用）

**优点：**

- ✅ 无需额外配置
- ✅ 文件体积小
- ✅ 兼容性最好
- ✅ 开发最简单

**缺点：**

- ❌ 不支持中文内容

**实施：**

```javascript
// 使用英文替代中文
doc.text('Hello, World!', 10, 10) // ✅ 正常
// doc.text('你好，世界！', 10, 10)  // ❌ 乱码
```

### 方案 2️⃣：嵌入中文字体（推荐用于生产环境）

#### jsPDF 嵌入中文字体

**步骤：**

1. **下载中文字体文件**

```bash
# 推荐使用思源黑体或阿里巴巴普惠体
# 下载 .ttf 字体文件
```

2. **转换字体为Base64**

```bash
# 使用在线工具或命令行工具转换
# 或使用 jsPDF 的字体转换工具
```

3. **在代码中使用**

```javascript
import { jsPDF } from 'jspdf'

// 引入字体文件（需要先转换）
import SourceHanSans from './fonts/SourceHanSans-Normal.ttf'

const doc = new jsPDF()

// 添加自定义字体
doc.addFileToVFS('SourceHanSans.ttf', SourceHanSans)
doc.addFont('SourceHanSans.ttf', 'SourceHanSans', 'normal')
doc.setFont('SourceHanSans')

// 现在可以使用中文了
doc.text('你好，世界！', 10, 10)
doc.save('chinese.pdf')
```

#### PDF-LIB 嵌入中文字体

```javascript
import { PDFDocument } from 'pdf-lib'
import fontkit from '@pdf-lib/fontkit'

const pdfDoc = await PDFDocument.create()
pdfDoc.registerFontkit(fontkit)

// 加载中文字体
const fontBytes = await fetch('/fonts/SourceHanSans.ttf').then((res) => res.arrayBuffer())
const customFont = await pdfDoc.embedFont(fontBytes)

const page = pdfDoc.addPage()
page.drawText('你好，世界！', {
  x: 50,
  y: 500,
  font: customFont, // 使用自定义字体
  size: 30,
})

const pdfBytes = await pdfDoc.save()
```

**注意事项：**

- 字体文件通常2-5MB，会增加应用体积
- 可以使用字体子集化减小文件大小
- 推荐字体：思源黑体、思源宋体、阿里巴巴普惠体（开源免费）

### 方案 3️⃣：print-html-element 正确导入

**修复前：**

```javascript
import printElement from 'print-html-element' // ❌ 不工作
```

**修复后：**

```javascript
const printElement = require('print-html-element') // ✅ 正确
```

**原因：**

- `print-html-element` 使用 CommonJS 导出
- 在某些构建配置下，ES6 import 可能无法正确处理
- 使用 require 确保兼容性

## 📚 字体资源推荐

### 免费开源中文字体

1. **思源黑体 (Source Han Sans)**
   - 下载：[GitHub](https://github.com/adobe-fonts/source-han-sans)
   - 特点：现代、清晰、完整的中日韩字符集
   - 体积：约 15MB（全字重）

2. **思源宋体 (Source Han Serif)**
   - 下载：[GitHub](https://github.com/adobe-fonts/source-han-serif)
   - 特点：传统、优雅、适合正式文档
   - 体积：约 15MB（全字重）

3. **阿里巴巴普惠体**
   - 下载：[阿里巴巴官网](https://www.alibabafonts.com/)
   - 特点：现代、友好、商用免费
   - 体积：约 3MB（Regular）

4. **文泉驿微米黑**
   - 下载：[SourceForge](http://wenq.org/)
   - 特点：轻量、开源、体积小
   - 体积：约 4MB

### 字体子集化工具

减小字体文件体积：

1. **Font-Spider（字蛛）**

   ```bash
   npm install font-spider -g
   font-spider index.html
   ```

2. **fontmin**

   ```bash
   npm install fontmin --save-dev
   ```

3. **在线工具**
   - [字体天下 - 字体子集化](https://www.fonts.net.cn/font-subset)
   - [FontTools](https://github.com/fonttools/fonttools)

## 🎯 最佳实践建议

### 开发阶段

- ✅ 使用英文内容进行开发和测试
- ✅ 验证功能和布局正确性
- ✅ 无需处理字体问题，提高开发效率

### 生产阶段

- ✅ 根据实际需求决定是否嵌入中文字体
- ✅ 使用字体子集化减小文件体积
- ✅ 仅包含项目中实际使用的字符
- ✅ 懒加载字体文件，优化首屏加载

### 场景选择

| 场景       | 推荐方案           | 说明                   |
| ---------- | ------------------ | ---------------------- |
| 演示/Demo  | 英文内容           | 简单快速，无需配置     |
| 国际化应用 | 动态加载字体       | 根据语言按需加载       |
| 中文为主   | 嵌入中文字体       | 一次性解决，体验好     |
| 包体积敏感 | 字体子集化         | 只包含需要的字符       |
| 简单打印   | print-html-element | HTML原生字体，无需处理 |

## 🔧 本项目的选择

**当前方案：** 使用英文内容

**理由：**

1. 这是一个技术调研报告/Demo项目
2. 主要展示功能和API用法
3. 避免增加项目复杂度和体积
4. 更好的跨语言展示效果

**如果需要中文支持：**

- 可以参考上述"方案2"进行配置
- 建议使用思源黑体或阿里巴巴普惠体
- 使用字体子集化工具减小体积

## 📝 总结

| 问题                   | 原因               | 解决方案               |
| ---------------------- | ------------------ | ---------------------- |
| jsPDF中文乱码          | 默认字体不支持中文 | 嵌入中文字体或使用英文 |
| PDF-LIB编码错误        | WinAnsi不支持中文  | 嵌入中文字体或使用英文 |
| print-html-element报错 | 模块导出方式问题   | 使用require导入        |

所有问题都已修复，项目现在可以正常运行！ 🎉
